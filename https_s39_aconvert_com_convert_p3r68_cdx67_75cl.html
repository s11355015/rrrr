<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 24.11.1" /><title></title><style type="text/css">body { font-family:'Times New Roman'; font-size:12pt }h1, h2, h3, h4, h5, h6, p { margin:0pt }h1 { margin-top:12pt; margin-bottom:0pt; page-break-inside:avoid; page-break-after:avoid; font-family:Calibri; font-size:24pt; font-weight:bold; font-style:normal; color:#2f5496 }h2 { margin-top:2pt; margin-bottom:0pt; page-break-inside:avoid; page-break-after:avoid; font-family:Calibri; font-size:18pt; font-weight:bold; font-style:normal; color:#2f5496 }h3 { margin-top:2pt; margin-bottom:0pt; page-break-inside:avoid; page-break-after:avoid; font-family:Calibri; font-size:14pt; font-weight:bold; font-style:normal; color:#1f3763 }h4 { margin-top:2pt; margin-bottom:0pt; page-break-inside:avoid; page-break-after:avoid; font-family:Calibri; font-size:12pt; font-weight:bold; font-style:normal; color:#2f5496 }h5 { margin-top:2pt; margin-bottom:0pt; page-break-inside:avoid; page-break-after:avoid; font-family:Calibri; font-size:10pt; font-weight:bold; font-style:normal; color:#2f5496 }h6 { margin-top:2pt; margin-bottom:0pt; page-break-inside:avoid; page-break-after:avoid; font-family:Calibri; font-size:8pt; font-weight:bold; font-style:normal; color:#1f3763 }.divSection1 { font-family:'Times New Roman'; font-size:12pt; -aw-style-name:'div_Section_1' }.prewestern { font-family:'Liberation Mono'; font-size:10pt; -aw-style-name:'pre_western' }span.Heading1Char { font-family:'Calibri Light'; font-size:16pt; color:#2f5496 }span.Heading2Char { font-family:'Calibri Light'; font-size:13pt; color:#2f5496 }span.Heading3Char { font-family:'Calibri Light'; font-size:12pt; color:#1f3763 }span.Heading4Char { font-family:'Calibri Light'; font-style:italic; color:#2f5496 }span.Heading5Char { font-family:'Calibri Light'; color:#2f5496 }span.Heading6Char { font-family:'Calibri Light'; color:#1f3763 }</style></head><body><div><p class="prewestern" style="margin-top:70.85pt; margin-right:70.85pt; margin-left:70.85pt"><span>//</span><span style="font-family:'Arial Unicode MS'">建立</span><span>I/O</span><span style="font-family:'Arial Unicode MS'">控制器，用全域方便學生直接網頁測試</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>//</span><span style="font-family:'Arial Unicode MS'">建立</span><span>diveWorld =&gt; controller</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>class Scenes {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>constructor(cols, rows, map) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.cols = Number(cols);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.rows = Number(rows);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.map = map;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.now_cols = 0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.now_rows = 0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>setMap(map) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.map = map</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getMap() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.map</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getTile(col, row) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.map[Number(row) * this.cols + Number(col)]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getIndex(col, row) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return Number(row) * this.cols + Number(col)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getTileByIndex(i) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.map[i]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getNowTile() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return [this.now_cols, this.now_rows]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getIndexByPID(pid) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.map.findIndex((e) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return e == pid</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>})</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>class DiveWorld {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>constructor(map, preload_json) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.app = document.querySelector("#dive-app");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.loading = document.querySelector(".loading");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.preload_json = preload_json;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.isInitial = true;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.reset = false;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.linkers = [];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.cache_pids = [];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.linker_index = 0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.pid = map[0];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.index = 0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.scenes = new Scenes(map_col, map_row, map);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.outputList = this.initOutput();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.complete_timer = null;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.init_timer = null;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.start_timer = null;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.input_timer = null;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.defaultCount = 6;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.init();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* get map data . initial map[0]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>init() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>window.addEventListener("click", triggerFull, false)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.nextStage();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.isInitial = false;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.fullScreen()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:ignore">&#xa0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>function triggerFull() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.fullScreen();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.hideBlock();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.start();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.hide();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>window.removeEventListener("click", triggerFull, false)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>startPreload() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let pid = (this.isInitial) ? this.scenes.getTileByIndex(0) : this.pid;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let isCustom = this.checkCustomPreload(pid);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.isInitial) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// first load map[00]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//TODO should refactory </span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.initPreload(1)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.setProject(pid);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (isCustom) return this.customPreload(pid)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.defaultPreload()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>customPreload(pid) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.reset) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.initPreload(1);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//jump tile</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let scenes = this.scenes;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.setProject(scenes.getTileByIndex(this.index));</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let preloadArray = this.getPreloadArray(pid);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.cache_pids = preloadArray;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.cache_index = preloadArray.map((e) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return _world.scenes.getIndexByPID(e)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const l = preloadArray.length;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.initPrelaods(l + 2);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>try {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (let i = 0; i &lt; l; i++) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const _pid = preloadArray[i];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>console.log("custome prelaod id" + _pid)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const _i = i + 1;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker(_i);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (linker) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.setProject(_pid);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.enableBlock(false);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>} catch (error) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>console.log("customPreload error : " + error);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>//init 4 iframe ,2 =&gt; 6 </span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>defaultPreload() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.reset) this.initPreload(1)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.initPrelaods(this.defaultCount);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let scenes = this.scenes;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.reset) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//jump tile </span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.setProject(scenes.getTileByIndex(this.index));</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let preload_array = [</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.index - scenes.cols,</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.index - 1,</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.index + 1,</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.index + scenes.cols</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.cache_index = preload_array;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.cache_pids = preload_array.map((e) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return scenes.getTileByIndex(e)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>//TODO</span><span style="-aw-import:spaces">&#xa0; </span><span>fragile</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>try {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (let i = 0; i &lt; this.cache_pids.length; i++) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const pid = this.cache_pids[i];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const _i = i + 1;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker(_i);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (linker &amp;&amp; pid) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.setProject(pid);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.enableBlock(false);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>} catch (error) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>console.log("defaultPreload error : " + error);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>checkCustomPreload(eid) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.preload_json[eid]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getPreloadArray(eid) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.preload_json[eid]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>initIframe(i) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let iframe = document.createElement("iframe");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>iframe.className = (i == 1) ? "dive preload" : "dive preload dive-hide";</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>iframe.setAttribute("name", "dive" + i);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return iframe</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>initLinker(i) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let option = (this.isInitial) ? {} : {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>"watermark": false</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>};</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const linker = new DiveLinker("dive" + i, option)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.linkers.push(linker);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>initPrelaods(count) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (let i = 2; i &lt; count; i++) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.initPreload(i);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>//just append .. refactory by Fragment</span><span style="-aw-import:spaces">&#xa0; </span><span>when slowly</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>initPreload(i) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.app.appendChild(this.initIframe(i));</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.initLinker(i);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>bind(func) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return function () {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return func.apply(world, arguments)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>bindTimer() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = _world.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.checkTimer("complete_timer");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.reset = false;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.complete_timer = setInterval(() =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!linker.checkComplete()) return</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>console.warn("go next :" + _world.complete_timer);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>clearInterval(_world.complete_timer);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delete _world.complete_timer;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.sleep(0.1)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>.then(linker.pause())</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>.then(_world.nextStage())</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}, 100);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>waitInit() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return new Promise((resolve, reject) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = _world.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.checkTimer("init_timer");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.init_timer = setInterval(() =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!linker.initial) return linker.getIOList()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>clearInterval(_world.init_timer)</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delete _world.init_timer;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>resolve()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}, 100);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>checkTimer(timer) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (_world[timer]) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>clearInterval(_world[timer]);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delete _world[timer];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>waitStart() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return new Promise((resolve, reject) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = _world.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.checkTimer("start_timer");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.isInitial) return resolve()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.start_timer = setInterval(() =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>console.warn("wait start");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (linker.checkDiveStatus() !== "start") return _world.start()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>clearInterval(_world.start_timer);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delete _world.start_timer;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>resolve()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}, 100);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>update() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.updateOutput();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let next_col = Number(this.get_world_output(col));</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let next_row = Number(this.get_world_output(row));</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.udpateScenes(next_col, next_row);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.updateIndex(next_col, next_row);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>// fix 20190808 </span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>nextStage() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!this.isInitial) this.update()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.isInitial) _world.fullScreen()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.startPreload();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>(async () =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>await _world.showNext();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>await _world.waitInit();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>await _world.setInput();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>await _world.hideBlock();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>await _world.waitStart();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>await _world.bindTimer();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>})();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>hideBlock() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return new Promise((resolve, reject) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.isInitial) return resolve()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.enableBlock(false);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>resolve();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>start() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.start();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.focusDIVE();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* return by i or nowIndex</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* @param {number} i</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getLinker(i) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return (i) ? this.linkers[i] : this.linkers[0]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>initOutput() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let result = {};</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>outputNames.push(row);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>outputNames.push(col);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (let i = 0; i &lt; outputNames.length; i++) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const output = outputNames[i];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>result[output] = {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>name: output,</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>value: 0</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return result</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>sleep(delay) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return new Promise((resolve, reject) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>setTimeout(() =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>resolve();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}, delay * 800);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* Useless</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* @param {Number} next_col</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* @param {Number} next_row</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>udpateScenes(next_col, next_row) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.scenes.now_cols = next_col;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.scenes.now_rows = next_row;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>updateOutput() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let new_outputs = linker.getOutputList();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let keep_outputs = this.get_world_outputs();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (const key in new_outputs) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (new_outputs.hasOwnProperty(key)) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const output = new_outputs[key];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (outputNames.indexOf(output.name) == -1) continue</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>keep_outputs[output.name]["value"] = output.value;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>updateIndex(next_col, next_row) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.pid = this.scenes.getTile(this.scenes.now_cols, this.scenes.now_rows);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let newIndex = this.scenes.getIndex(this.scenes.now_cols, this.scenes.now_rows);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _index = this.cache_index.findIndex(function (e) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return e == newIndex</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>})</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.linker_index = _index + 1;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.index = newIndex;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (_index == -1) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.reset = true;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.linkers = this.linkers.filter((e) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return e.getProjectID() == this.pid</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>})</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.adjustIframe();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>//TODO need to drop all . here has bug with chrome =&gt; iframe event</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>adjustIframe() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>document.querySelectorAll("iframe").forEach((e) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!_linker || e != _linker.target) e.remove()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>})</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (_world.reset) return</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_linker.target.setAttribute("name", "dive1");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_linker.target.classList.remove("preload");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_linker.enableBlock(false);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>get_world_outputs() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.outputList</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>get_world_output(name) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return this.outputList[name].value</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>setInput() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return new Promise((resolve, reject) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.isInitial) return resolve()</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let _world = this;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let linker = this.getLinker();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.checkTimer("input_timer");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>_world.input_timer = setInterval(() =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!linker.initial) return</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>clearInterval(_world.input_timer);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>delete _world.input_timer;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let inputs = linker.getInputList();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let outputList = this.get_world_outputs();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let inputArray = [];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (const key in inputs) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (inputs.hasOwnProperty(key)) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const input = inputs[key];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (outputNames.indexOf(input.name) == -1) continue</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let cache_output = outputList[input.name];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let obj = {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>id: input.id,</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>value: cache_output.value</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>inputArray.push(obj);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>linker.setInput(inputArray);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>resolve();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}, 100);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>isEmpty(obj) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (var key in obj) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (obj.hasOwnProperty(key))</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return false;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return true;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* default is loading</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* @param {HTMLElement} node</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>hide(node) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!node) return this.loading.classList.add("dive-hide")</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>node.classList.add("dive-hide")</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>focusDIVE() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>try {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let dom = document.querySelector("iframe[name=dive1");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>dom.contentWindow.focus();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>} catch (err) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>console.error('Error: Focus DIVE failed!', err);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* default is loading</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* @param {HTMLElement} node</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>show(node) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (!node) return this.loading.classList.remove("dive-hide")</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>node.classList.remove("dive-hide")</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>showNext() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return new Promise((resolve, reject) =&gt; {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let dom = document.querySelector("iframe[name=dive1");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>dom.classList.remove("dive-hide");</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.focusDIVE();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>resolve();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>});</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>fullScreen() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (document.fullscreenEnabled ||</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>document.webkitFullscreenEnabled ||</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>document.mozFullScreenEnabled ||</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>document.msFullscreenEnabled) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>// Do fullscreen</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (this.app.requestFullscreen) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.app.requestFullscreen();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>} else if (this.app.webkitRequestFullscreen) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.app.webkitRequestFullscreen();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>} else if (this.app.mozRequestFullScreen) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.app.mozRequestFullScreen();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>} else if (this.app.msRequestFullscreen) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>this.app.msRequestFullscreen();</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>mobilecheck() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>let check = false;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>(function (a) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>if (</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>.test(a) ||</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>.test(a.substr(0, 4))) check = true;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>})(navigator.userAgent || navigator.vendor || window.opera);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return check;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>};</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>* shakeHand with diveServer</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0; </span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>getID() {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const soup_ = '!#%()*+,-./:;=?@[]^_`{|}~' +</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const length = 20;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const soupLength = soup_.length;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>const id = [];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>for (let i = 0; i &lt; length; i++) {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>id[i] = soup_.charAt(Math.random() * soupLength);</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </span><span>return id.join('');</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/***************************************** </span><span style="font-family:'Arial Unicode MS'">以下為自訂參數</span><span>*****************************************/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>* </span><span style="font-family:'Arial Unicode MS'">要傳遞的輸出屬性名稱，請確保每個屬性在各實驗中都設定好</span><span>I/O</span><span style="font-family:'Arial Unicode MS'">並名稱一致</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const outputNames = [</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>"map[from]",</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>* </span><span style="font-family:'Arial Unicode MS'">切換時</span><span>[</span><span style="font-family:'Arial Unicode MS'">範例中進入傳送點時</span><span>]</span><span style="font-family:'Arial Unicode MS'">回傳的地圖</span><span>[</span><span style="font-family:'Arial Unicode MS'">列</span><span>]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>* </span><span style="font-family:'Arial Unicode MS'">切換時</span><span>[</span><span style="font-family:'Arial Unicode MS'">範例中進入傳送點時</span><span>]</span><span style="font-family:'Arial Unicode MS'">回傳的地圖</span><span>[</span><span style="font-family:'Arial Unicode MS'">行</span><span>]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const row = "row[output]";</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const col = "col[output]";</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/***************************</span><span style="font-family:'Arial Unicode MS'">以上是</span><span>I/O</span><span style="font-family:'Arial Unicode MS'">屬性設定</span><span>***************************/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:ignore">&#xa0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/***************************</span><span style="font-family:'Arial Unicode MS'">以下是地圖</span><span>&amp;</span><span style="font-family:'Arial Unicode MS'">地圖參數設定</span><span>***************************/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const map_col = 2; //</span><span style="font-family:'Arial Unicode MS'">地圖行</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const map_row = 2; //</span><span style="font-family:'Arial Unicode MS'">地圖列</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const map = [</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>32576, 32610,</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>32609, 32426</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>];</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/**</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>* </span><span style="font-family:'Arial Unicode MS'">「指定預載」</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>* </span><span style="font-family:'Arial Unicode MS'">可設定專案要預載的專案集合，未指定時採用「預設預載」。</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;</span><span>*/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>const preload_json = {</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>32576: [32610, 32609, 32426],</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>32610: [32576, 32609, 32426],</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>32609: [32576, 32610, 32426],</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:spaces">&#xa0;&#xa0;&#xa0; </span><span>32426: [32576, 32610, 32609]</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>}</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/***************************</span><span style="font-family:'Arial Unicode MS'">以上為自訂參數</span><span>***************************/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span style="-aw-import:ignore">&#xa0;</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>//put global. easy to check.</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt"><span>/***********************Code start************************************/</span></p><p class="prewestern" style="margin-right:70.85pt; margin-left:70.85pt; margin-bottom:70.85pt"><span>const diveWorld = new DiveWorld(map, preload_json);</span></p></div></body></html>